"use strict";(()=>{var e={};e.id=912,e.ids=[912],e.modules={11185:e=>{e.exports=require("mongoose")},72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},74515:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>c,originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>p,staticGenerationAsyncStorage:()=>l,staticGenerationBailout:()=>m});var s={};r.r(s),r.d(s,{GET:()=>o.HT,POST:()=>o.a4});var a=r(95419),n=r(69108),i=r(99678),o=r(14318);let u=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/[...nextauth]/route",pathname:"/api/auth/[...nextauth]",filename:"route",bundlePath:"app/api/auth/[...nextauth]/route"},resolvedPagePath:"C:\\Users\\KIIT\\Documents\\PROJECTS\\Next14 Task Manager\\src\\app\\api\\auth\\[...nextauth]\\route.js",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:p,headerHooks:c,staticGenerationBailout:m}=u,h="/api/auth/[...nextauth]/route";function x(){return(0,i.patchFetch)({serverHooks:p,staticGenerationAsyncStorage:l})}},95419:(e,t,r)=>{e.exports=r(30517)},14318:(e,t,r)=>{r.d(t,{HT:()=>c,a4:()=>m,I8:()=>h,zB:()=>x,w7:()=>g});var s=r(26077),a=r(83764),n=r(3133),i=r(78596),o=r(45989),u=r(6521),d=r.n(u);let l={pages:{signIn:"/login"},providers:[],callbacks:{jwt:async({token:e,user:t})=>(t&&(e.id=t.id,e.isAdmin=t.isAdmin,e.isUser=t.isUser,e.isThirdPerson=t.isThirdPerson),e),session:async({session:e,token:t})=>(t&&(e.user.id=t.id,e.user.isAdmin=t.isAdmin,e.user.isUser=t.isUser,e.user.isThirdPerson=t.isThirdPerson),e),authorized({auth:e,request:t}){let r=e?.user,s=t.nextUrl?.pathname.startsWith("/admin"),a=t.nextUrl?.pathname.startsWith("/statistics"),n=t.nextUrl?.pathname.startsWith("/task"),i=t.nextUrl?.pathname.startsWith("/add"),o=t.nextUrl?.pathname.startsWith("/login");return(!s||!!r?.isAdmin)&&(!n||!!r)&&(!i||!!r)&&(!a||!!r?.isAdmin)&&(!o||!r||Response.redirect(new URL("/",t.nextUrl)))}}},p=async e=>{try{await (0,i.T)();let t=await o.n.findOne({username:e.username});if(!t||!await d().compare(e.password,t.password))throw Error("Wrong credentials!");return t}catch(e){throw console.log(e),Error("Failed to login!")}},{handlers:{GET:c,POST:m},auth:h,signIn:x,signOut:g}=(0,s.Z)({...l,providers:[(0,a.Z)({clientId:process.env.GITHUB_ID,clientSecret:process.env.GITHUB_SECRET}),(0,n.Z)({async authorize(e){try{return await p(e)}catch(e){return null}}})],callbacks:{async signIn({user:e,account:t,profile:r}){if("github"===t.provider){await (0,i.T)();try{if(!await o.n.findOne({email:r.email})){let e=new o.n({username:r.login,email:r.email,image:r.avatar_url});await e.save()}}catch(e){return console.log(e),!1}}return!0},...l.callbacks}})},45989:(e,t,r)=>{r.d(t,{i:()=>u,n:()=>o});let{default:s,mongo:a}=r(11185),n=new s.Schema({username:{type:String,required:!0,unique:!0,min:3,max:20},email:{type:String,required:!0,unique:!0,max:50},password:{type:String,min:6},img:{type:String,default:""},isAdmin:{type:Boolean,default:!1},isUser:{type:Boolean,default:!1},isThirdPerson:{type:Boolean,default:!0},createdAt:{type:Date,default:Date.now()},tasks:[{type:s.Schema.Types.ObjectId,ref:"Task"}]}),i=new s.Schema({title:{type:String,required:!0},desc:{type:String,required:!0},status:{type:String,default:"assigned",enum:["assigned","completed"]},createdAt:{type:Date,default:Date.now()},userId:{type:s.Schema.Types.ObjectId,ref:"User"}}),o=s.models.User||s.model("User",n),u=s.models.Task||s.model("Task",i)},78596:(e,t,r)=>{r.d(t,{T:()=>n});let{default:s}=r(11185),a={},n=async()=>{try{if(a.isConnected){console.log("Using existing connection");return}let e=await s.connect(process.env.MONGO,{useNewUrlParser:!0,useUnifiedTopology:!0});a.isConnected=e.connections[0].readyState}catch(e){throw Error("Error connecting to database")}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,70,871],()=>r(74515));module.exports=s})();